/*! sun-dog 2016-02-11 */
var app=angular.module("sunDog",["ngRoute","socialLinks"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/landing.html",controller:"landingPage",controllerAs:"land"}).when("/signup",{templateUrl:"views/signup.html",controller:"signup",controllerAs:"signup"}).when("/account",{templateUrl:"views/account.html",controller:"account",controllerAs:"account"}),b.html5Mode(!0)}]),app.controller("landingPage",["zipCodeService","signUpService","$http","$location",function(a,b,c,d){this.zipCodeKeyPress=a.keyPress,this.zipCode=a.data,this.showLogin=function(){this.loginStatus=!0},this.loginFail=!1,this.login=function(){c.post("/",this.user).then(function(a){a.data._id?d.path("/account"):alert(a.data)})},this.reserveSpot=b.reserveSpot}]),app.controller("signup",["signUpService",function(a){this.data=a.data,this.signUp=a.signUp,this.next=a.next,this.agencyAgreement=a.agencyAgreement,this.dataPrivacyAgreement=a.dataPrivacyAgreement}]),app.controller("account",["accountService",function(a){this.data=a.data,this.save=a.save,this.logout=a.logout,this.savedStatus=a.savedStatus,a.getUser(),this.emailShow=!0,this.passwordShow=!0,this.firstNameShow=!0,this.lastNameShow=!0,this.accountShow=!0,this.premiseShow=!0,this.streetShow=!0,this.cityShow=!0,this.usageShow=!0}]),app.factory("zipCodeService",["$http","$location",function(a,b){var c={},d=function(){5==c.input.length&&(c.showSpinner=!0,a.post("/zipCode",c).then(function(a){c.showSpinner=!1,c.response=!0,c.utility=a.data.name,c.isNSP=a.data.isNSP}))};return{keyPress:d,data:c}}]),app.factory("accountService",["$http","$location",function(a,b){var c={};c.status="Please edit any information below as needed";var d=function(){a.get("/account/data").then(function(a){c.user=a.data[0]})},e=function(){a.put("account/update",c).then(function(a){200==a.status&&(c._id=a.data._id,c.savedStatus="changes saved successfully!")})},f=function(){a.get("/logout").then(function(a){b.path("/")})};return{save:e,logout:f,getUser:d,data:c}}]),app.factory("signUpService",["$http","$location",function(a,b){var c={status:"Join Sun Dog and sign up for solar today!",signUpCompleted:!1,nextCompleted:!1,agencyAgreementCompleted:!1,dataAgreementCompleted:!1},d=function(){validateEmail(this.user.emailAddress)?a.post("signUp/register",this.user).then(function(a){200==a.status&&(c.emailAddress=a.data.email,c._id=a.data._id,b.path("/signup"))}):console.log("email invalid")},e=function(){c.signUpError="",validatePassword(c.password)&&validateEmail(c.emailAddress)?(c.signUpCompleted=!0,a.post("signUp/addPassword",c).then(function(a){200==a.status&&(c._id=a.data._id,c.status="Registration successful")})):(validatePassword(c.password)||(c.signUpError="Password invalid. "),validateEmail(c.emailAddress)||(c.signUpError+="Email invalid."),console.log("nope"))},f=function(){a.post("/signUp/account",c).then(function(a){200==a.status&&(c.status="You're all set")}),c.nextCompleted=!0},g=function(){c.agencyAgreed?(a.post("/signUp/agency",c).then(function(a){200==a.status&&(c.status="You're all set")}),c.agencyAgreementCompleted=!0,c.status="Data Privacy Agreement"):c.status="Please check the box to continue"},h=function(){c.dataAgreed?(a.post("/signUp/data",c).then(function(a){200==a.status&&(c.status="You're all set")}),c.dataAgreementCompleted=!0,c.status="arf arf!"):c.status="Please check the box to continue"};return{reserveSpot:d,signUp:e,next:f,agencyAgreement:g,dataPrivacyAgreement:h,data:c}}]);var validatePassword=function(a){return a.length>=7?!0:!1},validateEmail=function(a){var b=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return a.match(b)?!0:!1};